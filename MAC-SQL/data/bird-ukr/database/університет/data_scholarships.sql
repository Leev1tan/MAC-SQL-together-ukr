-- Дані про стипендії для бази даних "Університет"
-- Encoding: UTF-8

-- =============================================
-- Стипендії студентів
-- =============================================

-- Очищуємо таблицю стипендій, якщо вона містить дані
TRUNCATE TABLE стипендії RESTART IDENTITY CASCADE;

-- Типи стипендій
INSERT INTO типи_стипендій (назва, опис, кількість_виплат_на_рік) VALUES
('Академічна звичайна', 'Базова стипендія для студентів з хорошою успішністю', 10),
('Академічна підвищена', 'Підвищена стипендія для студентів з високою успішністю', 10),
('Соціальна', 'Стипендія для соціально незахищених категорій студентів', 12),
('Президентська', 'Стипендія Президента України для найкращих студентів', 12),
('Іменна', 'Іменна стипендія від спонсорів та партнерів університету', 10),
('Стипендія ім. В.Вернадського', 'Стипендія для наукових досліджень', 12),
('Міжнародна', 'Стипендія для участі в міжнародних програмах обміну', 4);

-- Призначаємо академічні стипендії для студентів з високим середнім балом
INSERT INTO стипендії (студент_ід, тип_стипендії_ід, розмір, дата_початку, дата_кінця, підстава)
SELECT 
    с.ід,
    (SELECT ід FROM типи_стипендій WHERE назва = 'Академічна підвищена'),
    2500.00,
    '2023-09-01',
    '2024-01-31',
    'Висока успішність за результатами сесії'
FROM 
    студенти с
WHERE 
    с.середній_бал >= 90
    AND с.статус_ід = (SELECT ід FROM статуси_студентів WHERE назва = 'Навчається')
    AND с.форма_навчання = 'Денна'
    AND с.чи_бюджет = TRUE;

-- Призначаємо звичайні академічні стипендії для студентів з добрим середнім балом
INSERT INTO стипендії (студент_ід, тип_стипендії_ід, розмір, дата_початку, дата_кінця, підстава)
SELECT 
    с.ід,
    (SELECT ід FROM типи_стипендій WHERE назва = 'Академічна звичайна'),
    2000.00,
    '2023-09-01',
    '2024-01-31',
    'Добра успішність за результатами сесії'
FROM 
    студенти с
WHERE 
    с.середній_бал >= 80
    AND с.середній_бал < 90
    AND с.статус_ід = (SELECT ід FROM статуси_студентів WHERE назва = 'Навчається')
    AND с.форма_навчання = 'Денна'
    AND с.чи_бюджет = TRUE;

-- Призначаємо соціальні стипендії для окремих категорій студентів
INSERT INTO стипендії (студент_ід, тип_стипендії_ід, розмір, дата_початку, дата_кінця, підстава)
SELECT 
    с.ід,
    (SELECT ід FROM типи_стипендій WHERE назва = 'Соціальна'),
    2300.00,
    '2023-09-01',
    '2024-06-30',
    'Студент з малозабезпеченої сім''ї'
FROM 
    студенти с
WHERE 
    с.ід IN (
        (SELECT ід FROM студенти WHERE прізвище = 'Мельник' AND імя = 'Олександра'),
        (SELECT ід FROM студенти WHERE прізвище = 'Бойко' AND імя = 'Микола'),
        (SELECT ід FROM студенти WHERE прізвище = 'Коваленко' AND імя = 'Аліна')
    )
    AND с.статус_ід = (SELECT ід FROM статуси_студентів WHERE назва = 'Навчається')
    AND с.чи_бюджет = TRUE;

-- Призначаємо Президентську стипендію для найкращих студентів
INSERT INTO стипендії (студент_ід, тип_стипендії_ід, розмір, дата_початку, дата_кінця, підстава)
SELECT 
    с.ід,
    (SELECT ід FROM типи_стипендій WHERE назва = 'Президентська'),
    4500.00,
    '2023-09-01',
    '2024-06-30',
    'Найвищі академічні досягнення та активна наукова діяльність'
FROM 
    студенти с
WHERE 
    с.середній_бал >= 95
    AND с.ід IN (
        (SELECT ід FROM студенти WHERE прізвище = 'Коваль' AND імя = 'Дмитро'),
        (SELECT ід FROM студенти WHERE прізвище = 'Шевченко' AND імя = 'Марія')
    )
    AND с.статус_ід = (SELECT ід FROM статуси_студентів WHERE назва = 'Навчається')
    AND с.чи_бюджет = TRUE;

-- Призначаємо іменні стипендії від спонсорів
INSERT INTO стипендії (студент_ід, тип_стипендії_ід, розмір, дата_початку, дата_кінця, підстава)
SELECT 
    с.ід,
    (SELECT ід FROM типи_стипендій WHERE назва = 'Іменна'),
    3500.00,
    '2023-09-01',
    '2024-06-30',
    'Іменна стипендія від компанії GlobalLogic за успіхи в IT'
FROM 
    студенти с
    JOIN групи г ON с.група_ід = г.ід
    JOIN напрями н ON г.напрям_ід = н.ід
WHERE 
    н.назва LIKE '%Комп%'
    AND с.середній_бал >= 92
    AND с.ід IN (
        (SELECT ід FROM студенти WHERE прізвище = 'Петренко' AND імя = 'Артем'),
        (SELECT ід FROM студенти WHERE прізвище = 'Іваненко' AND імя = 'Софія')
    )
    AND с.статус_ід = (SELECT ід FROM статуси_студентів WHERE назва = 'Навчається')
    AND с.чи_бюджет = TRUE;

-- Призначаємо стипендію ім. В.Вернадського для наукових досліджень
INSERT INTO стипендії (студент_ід, тип_стипендії_ід, розмір, дата_початку, дата_кінця, підстава)
SELECT 
    с.ід,
    (SELECT ід FROM типи_стипендій WHERE назва = 'Стипендія ім. В.Вернадського'),
    4000.00,
    '2023-09-01',
    '2024-06-30',
    'За видатні результати наукових досліджень'
FROM 
    студенти с
WHERE 
    с.ід IN (
        (SELECT ід FROM студенти WHERE прізвище = 'Лисенко' AND імя = 'Олег')
    )
    AND с.статус_ід = (SELECT ід FROM статуси_студентів WHERE назва = 'Навчається')
    AND с.чи_бюджет = TRUE;

-- Призначаємо міжнародні стипендії для участі в програмах обміну
INSERT INTO стипендії (студент_ід, тип_стипендії_ід, розмір, дата_початку, дата_кінця, підстава)
SELECT 
    с.ід,
    (SELECT ід FROM типи_стипендій WHERE назва = 'Міжнародна'),
    6000.00,
    '2023-10-01',
    '2023-12-31',
    'Участь у програмі обміну з Варшавським університетом'
FROM 
    студенти с
WHERE 
    с.ід IN (
        (SELECT ід FROM студенти WHERE прізвище = 'Захарченко' AND імя = 'Анна'),
        (SELECT ід FROM студенти WHERE прізвище = 'Ткаченко' AND імя = 'Максим')
    )
    AND с.статус_ід = (SELECT ід FROM статуси_студентів WHERE назва = 'Навчається')
    AND с.чи_бюджет = TRUE;

-- Оновлюємо відмітку про отримання стипендії для студентів
UPDATE студенти
SET чи_отримує_стипендію = TRUE
WHERE ід IN (SELECT DISTINCT студент_ід FROM стипендії WHERE дата_кінця >= CURRENT_DATE); 