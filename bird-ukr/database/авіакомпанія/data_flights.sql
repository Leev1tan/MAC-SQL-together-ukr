-- Імпорт даних про рейси для бази даних "Авіакомпанія"

-- Генерація даних про рейси
-- Створюємо рейси з урахуванням маршрутів, літаків та розкладу

-- Отримуємо ID статусів рейсів для зручності
WITH статуси AS (
    SELECT id, назва FROM статуси_рейсів
),
-- Отримуємо ID літаків для зручності
літаки AS (
    SELECT id, тип_літака_id, реєстраційний_номер FROM літаки
),
-- Отримуємо ID маршрутів для зручності
маршрути AS (
    SELECT 
        m.id, 
        m.аеропорт_відправлення_id, 
        m.аеропорт_призначення_id, 
        m.приблизний_час_польоту,
        m.базова_вартість,
        a1.код_іата AS код_відправлення,
        a2.код_іата AS код_призначення
    FROM маршрути m
    JOIN аеропорти a1 ON m.аеропорт_відправлення_id = a1.id
    JOIN аеропорти a2 ON m.аеропорт_призначення_id = a2.id
)

-- Вставка даних про рейси
INSERT INTO рейси (
    номер_рейсу, 
    маршрут_id, 
    літак_id, 
    дата_час_відправлення, 
    дата_час_прибуття, 
    фактичний_час_відправлення, 
    фактичний_час_прибуття, 
    статус_id, 
    кількість_місць_економ, 
    кількість_місць_бізнес, 
    кількість_місць_перший_клас, 
    доступно_місць_економ, 
    доступно_місць_бізнес, 
    доступно_місць_перший_клас, 
    вартість_економ, 
    вартість_бізнес, 
    вартість_перший_клас, 
    погодні_умови, 
    примітки
) VALUES
-- Регулярні внутрішні рейси (з Києва до інших міст України)
('PS101', 
 (SELECT id FROM маршрути WHERE (SELECT код_іата FROM аеропорти WHERE id = аеропорт_відправлення_id) = 'KBP' AND 
                              (SELECT код_іата FROM аеропорти WHERE id = аеропорт_призначення_id) = 'LWO' LIMIT 1),
 (SELECT id FROM літаки WHERE реєстраційний_номер = 'UR-PSA' LIMIT 1),
 '2024-07-15 08:00:00', '2024-07-15 09:00:00', '2024-07-15 08:05:00', '2024-07-15 09:10:00',
 (SELECT id FROM статуси_рейсів WHERE назва = 'Прибув' LIMIT 1),
 150, 30, 0, 25, 5, 0, 1500.00, 3750.00, 0.00,
 'Ясно', 'Рейс виконано за розкладом'),

('PS102', 
 (SELECT id FROM маршрути WHERE (SELECT код_іата FROM аеропорти WHERE id = аеропорт_відправлення_id) = 'LWO' AND 
                              (SELECT код_іата FROM аеропорти WHERE id = аеропорт_призначення_id) = 'KBP' LIMIT 1),
 (SELECT id FROM літаки WHERE реєстраційний_номер = 'UR-PSA' LIMIT 1),
 '2024-07-15 10:30:00', '2024-07-15 11:30:00', '2024-07-15 10:40:00', '2024-07-15 11:35:00',
 (SELECT id FROM статуси_рейсів WHERE назва = 'Прибув' LIMIT 1),
 150, 30, 0, 15, 3, 0, 1500.00, 3750.00, 0.00,
 'Ясно', 'Незначна затримка через завантаження багажу'),

('PS103', 
 (SELECT id FROM маршрути WHERE (SELECT код_іата FROM аеропорти WHERE id = аеропорт_відправлення_id) = 'KBP' AND 
                              (SELECT код_іата FROM аеропорти WHERE id = аеропорт_призначення_id) = 'ODS' LIMIT 1),
 (SELECT id FROM літаки WHERE реєстраційний_номер = 'UR-PSB' LIMIT 1),
 '2024-07-15 09:00:00', '2024-07-15 09:55:00', '2024-07-15 09:00:00', '2024-07-15 09:55:00',
 (SELECT id FROM статуси_рейсів WHERE назва = 'Прибув' LIMIT 1),
 150, 30, 0, 20, 8, 0, 1450.00, 3625.00, 0.00,
 'Ясно', 'Рейс виконано за розкладом'),

('PS104', 
 (SELECT id FROM маршрути WHERE (SELECT код_іата FROM аеропорти WHERE id = аеропорт_відправлення_id) = 'ODS' AND 
                              (SELECT код_іата FROM аеропорти WHERE id = аеропорт_призначення_id) = 'KBP' LIMIT 1),
 (SELECT id FROM літаки WHERE реєстраційний_номер = 'UR-PSB' LIMIT 1),
 '2024-07-15 11:00:00', '2024-07-15 11:55:00', '2024-07-15 11:15:00', '2024-07-15 12:05:00',
 (SELECT id FROM статуси_рейсів WHERE назва = 'Прибув' LIMIT 1),
 150, 30, 0, 22, 10, 0, 1450.00, 3625.00, 0.00,
 'Ясно', 'Незначна затримка через пізнє прибуття літака'),

-- Міжнародні рейси (з Києва)
('PS301', 
 (SELECT id FROM маршрути WHERE (SELECT код_іата FROM аеропорти WHERE id = аеропорт_відправлення_id) = 'KBP' AND 
                              (SELECT код_іата FROM аеропорти WHERE id = аеропорт_призначення_id) = 'WAW' LIMIT 1),
 (SELECT id FROM літаки WHERE реєстраційний_номер = 'UR-PSC' LIMIT 1),
 '2024-07-15 06:30:00', '2024-07-15 08:00:00', '2024-07-15 06:40:00', '2024-07-15 08:10:00',
 (SELECT id FROM статуси_рейсів WHERE назва = 'Прибув' LIMIT 1),
 160, 40, 0, 30, 15, 0, 3500.00, 8750.00, 0.00,
 'Малохмарно', 'Незначна турбулентність під час польоту'),

('PS302', 
 (SELECT id FROM маршрути WHERE (SELECT код_іата FROM аеропорти WHERE id = аеропорт_відправлення_id) = 'WAW' AND 
                              (SELECT код_іата FROM аеропорти WHERE id = аеропорт_призначення_id) = 'KBP' LIMIT 1),
 (SELECT id FROM літаки WHERE реєстраційний_номер = 'UR-PSC' LIMIT 1),
 '2024-07-15 09:30:00', '2024-07-15 11:00:00', '2024-07-15 09:30:00', '2024-07-15 11:05:00',
 (SELECT id FROM статуси_рейсів WHERE назва = 'Прибув' LIMIT 1),
 160, 40, 0, 25, 10, 0, 3500.00, 8750.00, 0.00,
 'Хмарно', 'Стандартний рейс без особливостей'),

('PS401', 
 (SELECT id FROM маршрути WHERE (SELECT код_іата FROM аеропорти WHERE id = аеропорт_відправлення_id) = 'KBP' AND 
                              (SELECT код_іата FROM аеропорти WHERE id = аеропорт_призначення_id) = 'FRA' LIMIT 1),
 (SELECT id FROM літаки WHERE реєстраційний_номер = 'UR-PSD' LIMIT 1),
 '2024-07-15 12:00:00', '2024-07-15 15:00:00', '2024-07-15 12:15:00', '2024-07-15 15:10:00',
 (SELECT id FROM статуси_рейсів WHERE назва = 'Прибув' LIMIT 1),
 180, 50, 10, 40, 20, 3, 6500.00, 16250.00, 26000.00,
 'Ясно', 'Незначна затримка через повітряний трафік'),

('PS402', 
 (SELECT id FROM маршрути WHERE (SELECT код_іата FROM аеропорти WHERE id = аеропорт_відправлення_id) = 'FRA' AND 
                              (SELECT код_іата FROM аеропорти WHERE id = аеропорт_призначення_id) = 'KBP' LIMIT 1),
 (SELECT id FROM літаки WHERE реєстраційний_номер = 'UR-PSD' LIMIT 1),
 '2024-07-15 16:30:00', '2024-07-15 19:30:00', '2024-07-15 16:30:00', '2024-07-15 19:25:00',
 (SELECT id FROM статуси_рейсів WHERE назва = 'Прибув' LIMIT 1),
 180, 50, 10, 35, 15, 4, 6500.00, 16250.00, 26000.00,
 'Малохмарно', 'Прибуття раніше запланованого часу'),

-- Далекі міжнародні рейси
('PS501', 
 (SELECT id FROM маршрути WHERE (SELECT код_іата FROM аеропорти WHERE id = аеропорт_відправлення_id) = 'KBP' AND 
                              (SELECT код_іата FROM аеропорти WHERE id = аеропорт_призначення_id) = 'JFK' LIMIT 1),
 (SELECT id FROM літаки WHERE реєстраційний_номер = 'UR-PSE' LIMIT 1),
 '2024-07-15 10:00:00', '2024-07-15 19:40:00', '2024-07-15 10:10:00', '2024-07-15 19:35:00',
 (SELECT id FROM статуси_рейсів WHERE назва = 'Прибув' LIMIT 1),
 250, 70, 20, 80, 25, 5, 19500.00, 48750.00, 78000.00,
 'Ясно', 'Тривалий переліт, прибуття раніше запланованого часу'),

('PS502', 
 (SELECT id FROM маршрути WHERE (SELECT код_іата FROM аеропорти WHERE id = аеропорт_відправлення_id) = 'JFK' AND 
                              (SELECT код_іата FROM аеропорти WHERE id = аеропорт_призначення_id) = 'KBP' LIMIT 1),
 (SELECT id FROM літаки WHERE реєстраційний_номер = 'UR-PSE' LIMIT 1),
 '2024-07-16 00:00:00', '2024-07-16 09:40:00', NULL, NULL,
 (SELECT id FROM статуси_рейсів WHERE назва = 'Запланований' LIMIT 1),
 250, 70, 20, 100, 30, 8, 19500.00, 48750.00, 78000.00,
 'Прогнозується ясно', 'Запланований рейс'),

('PS601', 
 (SELECT id FROM маршрути WHERE (SELECT код_іата FROM аеропорти WHERE id = аеропорт_відправлення_id) = 'KBP' AND 
                              (SELECT код_іата FROM аеропорти WHERE id = аеропорт_призначення_id) = 'DXB' LIMIT 1),
 (SELECT id FROM літаки WHERE реєстраційний_номер = 'UR-PSF' LIMIT 1),
 '2024-07-15 23:00:00', '2024-07-16 05:00:00', '2024-07-15 23:15:00', NULL,
 (SELECT id FROM статуси_рейсів WHERE назва = 'У польоті' LIMIT 1),
 200, 60, 10, 55, 22, 5, 12500.00, 31250.00, 50000.00,
 'Ясно', 'Літак в повітрі'),

-- Майбутні рейси
('PS105', 
 (SELECT id FROM маршрути WHERE (SELECT код_іата FROM аеропорти WHERE id = аеропорт_відправлення_id) = 'KBP' AND 
                              (SELECT код_іата FROM аеропорти WHERE id = аеропорт_призначення_id) = 'LWO' LIMIT 1),
 (SELECT id FROM літаки WHERE реєстраційний_номер = 'UR-PSA' LIMIT 1),
 '2024-07-16 08:00:00', '2024-07-16 09:00:00', NULL, NULL,
 (SELECT id FROM статуси_рейсів WHERE назва = 'Запланований' LIMIT 1),
 150, 30, 0, 120, 25, 0, 1500.00, 3750.00, 0.00,
 'Прогнозується ясно', 'Запланований рейс'),

('PS106', 
 (SELECT id FROM маршрути WHERE (SELECT код_іата FROM аеропорти WHERE id = аеропорт_відправлення_id) = 'LWO' AND 
                              (SELECT код_іата FROM аеропорти WHERE id = аеропорт_призначення_id) = 'KBP' LIMIT 1),
 (SELECT id FROM літаки WHERE реєстраційний_номер = 'UR-PSA' LIMIT 1),
 '2024-07-16 10:30:00', '2024-07-16 11:30:00', NULL, NULL,
 (SELECT id FROM статуси_рейсів WHERE назва = 'Запланований' LIMIT 1),
 150, 30, 0, 130, 28, 0, 1500.00, 3750.00, 0.00,
 'Прогнозується ясно', 'Запланований рейс'),

-- Затримані рейси
('PS201', 
 (SELECT id FROM маршрути WHERE (SELECT код_іата FROM аеропорти WHERE id = аеропорт_відправлення_id) = 'KBP' AND 
                              (SELECT код_іата FROM аеропорти WHERE id = аеропорт_призначення_id) = 'DNK' LIMIT 1),
 (SELECT id FROM літаки WHERE реєстраційний_номер = 'UR-PSB' LIMIT 1),
 '2024-07-15 15:00:00', '2024-07-15 15:50:00', '2024-07-15 16:30:00', '2024-07-15 17:20:00',
 (SELECT id FROM статуси_рейсів WHERE назва = 'Прибув' LIMIT 1),
 150, 30, 0, 80, 15, 0, 1400.00, 3500.00, 0.00,
 'Гроза', 'Затримка через грозу в аеропорту відправлення'),

-- Скасовані рейси
('PS202', 
 (SELECT id FROM маршрути WHERE (SELECT код_іата FROM аеропорти WHERE id = аеропорт_відправлення_id) = 'DNK' AND 
                              (SELECT код_іата FROM аеропорти WHERE id = аеропорт_призначення_id) = 'KBP' LIMIT 1),
 (SELECT id FROM літаки WHERE реєстраційний_номер = 'UR-PSB' LIMIT 1),
 '2024-07-15 17:00:00', '2024-07-15 17:50:00', NULL, NULL,
 (SELECT id FROM статуси_рейсів WHERE назва = 'Скасовано' LIMIT 1),
 150, 30, 0, 150, 30, 0, 1400.00, 3500.00, 0.00,
 'Гроза', 'Рейс скасовано через сильну грозу та технічні проблеми'),

-- Рейси з технічними проблемами
('PS701', 
 (SELECT id FROM маршрути WHERE (SELECT код_іата FROM аеропорти WHERE id = аеропорт_відправлення_id) = 'KBP' AND 
                              (SELECT код_іата FROM аеропорти WHERE id = аеропорт_призначення_id) = 'IST' LIMIT 1),
 (SELECT id FROM літаки WHERE реєстраційний_номер = 'UR-PSG' LIMIT 1),
 '2024-07-15 14:00:00', '2024-07-15 16:00:00', '2024-07-15 14:00:00', NULL,
 (SELECT id FROM статуси_рейсів WHERE назва = 'Затримано' LIMIT 1),
 160, 40, 10, 100, 30, 8, 4200.00, 10500.00, 16800.00,
 'Ясно', 'Рейс затримано через технічні проблеми з двигуном'); 