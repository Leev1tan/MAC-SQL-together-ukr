[
    {
        "question_id": "авіакомпанія_001",
        "db_id": "авіакомпанія",
        "question": "Скільки літаків знаходиться в активному статусі?",
        "gold_sql": "SELECT COUNT(*) FROM літаки WHERE статус = 'Активний';",
        "difficulty": "simple"
    },
    {
        "question_id": "авіакомпанія_002",
        "db_id": "авіакомпанія",
        "question": "Які посади мають найвищу базову зарплату?",
        "gold_sql": "SELECT назва, базова_зарплата FROM посади ORDER BY базова_зарплата DESC LIMIT 5;",
        "difficulty": "simple"
    },
    {
        "question_id": "авіакомпанія_003",
        "db_id": "авіакомпанія",
        "question": "Скільки пасажирів зареєстровано в системі?",
        "gold_sql": "SELECT COUNT(*) FROM пасажири;",
        "difficulty": "simple"
    },
    {
        "question_id": "авіакомпанія_004",
        "db_id": "авіакомпанія",
        "question": "Які типи літаків мають максимальну кількість пасажирів більше 200?",
        "gold_sql": "SELECT назва, виробник, максимальна_кількість_пасажирів FROM типи_літаків WHERE максимальна_кількість_пасажирів > 200;",
        "difficulty": "simple"
    },
    {
        "question_id": "авіакомпанія_005",
        "db_id": "авіакомпанія",
        "question": "Знайдіть всі аеропорти, що знаходяться в Україні.",
        "gold_sql": "SELECT код_іата, назва, місто FROM аеропорти WHERE країна = 'Україна';",
        "difficulty": "simple"
    },
    {
        "question_id": "авіакомпанія_006",
        "db_id": "авіакомпанія",
        "question": "Скільки рейсів заплановано для кожного літака на наступний місяць?",
        "gold_sql": "\n        SELECT л.реєстраційний_номер, т.назва AS тип_літака, COUNT(р.id) AS кількість_рейсів\n        FROM літаки л\n        JOIN типи_літаків т ON л.тип_літака_id = т.id\n        LEFT JOIN рейси р ON л.id = р.літак_id\n        WHERE р.дата_час_відправлення BETWEEN CURRENT_DATE AND (CURRENT_DATE + INTERVAL '1 month')\n        GROUP BY л.id, л.реєстраційний_номер, т.назва\n        ORDER BY кількість_рейсів DESC;\n        ",
        "difficulty": "medium"
    },
    {
        "question_id": "авіакомпанія_007",
        "db_id": "авіакомпанія",
        "question": "Для кожного маршруту знайдіть середню заповненість літаків (у відсотках від максимальної місткості).",
        "gold_sql": "\n        SELECT \n            а1.місто AS місто_відправлення, \n            а2.місто AS місто_призначення,\n            AVG(\n                (р.кількість_місць_економ - р.доступно_місць_економ + \n                 р.кількість_місць_бізнес - р.доступно_місць_бізнес + \n                 р.кількість_місць_перший_клас - р.доступно_місць_перший_клас) * 100.0 / \n                (р.кількість_місць_економ + р.кількість_місць_бізнес + р.кількість_місць_перший_клас)\n            ) AS середня_заповненість_відсоток\n        FROM рейси р\n        JOIN маршрути м ON р.маршрут_id = м.id\n        JOIN аеропорти а1 ON м.аеропорт_відправлення_id = а1.id\n        JOIN аеропорти а2 ON м.аеропорт_призначення_id = а2.id\n        WHERE р.статус_id IN (\n            SELECT id FROM статуси_рейсів WHERE назва IN ('Виконано', 'В польоті')\n        )\n        GROUP BY м.id, а1.місто, а2.місто\n        ORDER BY середня_заповненість_відсоток DESC;\n        ",
        "difficulty": "medium"
    },
    {
        "question_id": "авіакомпанія_008",
        "db_id": "авіакомпанія",
        "question": "Знайдіть 10 найбільш прибуткових рейсів за останній місяць.",
        "gold_sql": "\n        SELECT \n            р.номер_рейсу, \n            а1.місто AS місто_відправлення, \n            а2.місто AS місто_призначення,\n            р.дата_час_відправлення,\n            (\n                (р.кількість_місць_економ - р.доступно_місць_економ) * р.вартість_економ +\n                (р.кількість_місць_бізнес - р.доступно_місць_бізнес) * р.вартість_бізнес +\n                (р.кількість_місць_перший_клас - р.доступно_місць_перший_клас) * р.вартість_перший_клас\n            ) AS загальний_дохід\n        FROM рейси р\n        JOIN маршрути м ON р.маршрут_id = м.id\n        JOIN аеропорти а1 ON м.аеропорт_відправлення_id = а1.id\n        JOIN аеропорти а2 ON м.аеропорт_призначення_id = а2.id\n        WHERE р.дата_час_відправлення >= CURRENT_DATE - INTERVAL '1 month'\n          AND р.статус_id IN (SELECT id FROM статуси_рейсів WHERE назва = 'Виконано')\n        ORDER BY загальний_дохід DESC\n        LIMIT 10;\n        ",
        "difficulty": "medium"
    },
    {
        "question_id": "авіакомпанія_009",
        "db_id": "авіакомпанія",
        "question": "Які пілоти здійснили найбільшу кількість рейсів за останній рік?",
        "gold_sql": "\n        SELECT \n            п.прізвище, \n            п.імя, \n            COUNT(рп.рейс_id) AS кількість_рейсів\n        FROM персонал п\n        JOIN рейси_персонал рп ON п.id = рп.персонал_id\n        JOIN рейси р ON рп.рейс_id = р.id\n        JOIN посади пос ON п.посада_id = пос.id\n        WHERE р.дата_час_відправлення >= CURRENT_DATE - INTERVAL '1 year'\n          AND р.статус_id IN (SELECT id FROM статуси_рейсів WHERE назва = 'Виконано')\n          AND пос.назва LIKE '%пілот%'\n        GROUP BY п.id, п.прізвище, п.імя\n        ORDER BY кількість_рейсів DESC\n        LIMIT 10;\n        ",
        "difficulty": "medium"
    },
    {
        "question_id": "авіакомпанія_010",
        "db_id": "авіакомпанія",
        "question": "Для кожного класу обслуговування порахуйте середню вартість бронювання та кількість пасажирів.",
        "gold_sql": "\n        SELECT \n            ко.назва AS клас_обслуговування, \n            COUNT(б.id) AS кількість_бронювань,\n            COUNT(бп.пасажир_id) AS кількість_пасажирів,\n            AVG(б.загальна_вартість) AS середня_вартість,\n            SUM(б.загальна_вартість) AS загальний_дохід\n        FROM бронювання б\n        JOIN класи_обслуговування ко ON б.клас_обслуговування_id = ко.id\n        JOIN бронювання_пасажири бп ON б.id = бп.бронювання_id\n        GROUP BY ко.id, ко.назва\n        ORDER BY загальний_дохід DESC;\n        ",
        "difficulty": "medium"
    },
    {
        "question_id": "авіакомпанія_011",
        "db_id": "авіакомпанія",
        "question": "Знайдіть маршрути, на яких за останні 3 місяці було найбільше затримок вильоту (більше 30 хвилин).",
        "gold_sql": "\n        SELECT \n            а1.місто AS місто_відправлення, \n            а2.місто AS місто_призначення,\n            COUNT(р.id) AS загальна_кількість_рейсів,\n            SUM(CASE \n                WHEN EXTRACT(EPOCH FROM (р.фактичний_час_відправлення - р.дата_час_відправлення))/60 > 30 \n                THEN 1 ELSE 0 \n            END) AS кількість_затримок,\n            ROUND(SUM(CASE \n                WHEN EXTRACT(EPOCH FROM (р.фактичний_час_відправлення - р.дата_час_відправлення))/60 > 30 \n                THEN 1 ELSE 0 \n            END) * 100.0 / COUNT(р.id), 2) AS відсоток_затримок,\n            AVG(CASE \n                WHEN EXTRACT(EPOCH FROM (р.фактичний_час_відправлення - р.дата_час_відправлення))/60 > 30 \n                THEN EXTRACT(EPOCH FROM (р.фактичний_час_відправлення - р.дата_час_відправлення))/60 \n                ELSE NULL \n            END) AS середня_затримка_хвилин\n        FROM рейси р\n        JOIN маршрути м ON р.маршрут_id = м.id\n        JOIN аеропорти а1 ON м.аеропорт_відправлення_id = а1.id\n        JOIN аеропорти а2 ON м.аеропорт_призначення_id = а2.id\n        WHERE р.дата_час_відправлення >= CURRENT_DATE - INTERVAL '3 month'\n          AND р.фактичний_час_відправлення IS NOT NULL\n        GROUP BY м.id, а1.місто, а2.місто\n        HAVING COUNT(р.id) >= 10\n          AND SUM(CASE \n                WHEN EXTRACT(EPOCH FROM (р.фактичний_час_відправлення - р.дата_час_відправлення))/60 > 30 \n                THEN 1 ELSE 0 \n            END) > 0\n        ORDER BY відсоток_затримок DESC, кількість_затримок DESC\n        LIMIT 10;\n        ",
        "difficulty": "complex"
    },
    {
        "question_id": "авіакомпанія_012",
        "db_id": "авіакомпанія",
        "question": "Знайдіть пасажирів, які здійснили найбільше рейсів за останній рік та їхній загальний наліт годин.",
        "gold_sql": "\n        WITH рейси_пасажирів AS (\n            SELECT \n                п.id AS пасажир_id,\n                п.прізвище,\n                п.імя,\n                р.id AS рейс_id,\n                EXTRACT(EPOCH FROM (р.фактичний_час_прибуття - р.фактичний_час_відправлення))/3600 AS тривалість_годин\n            FROM пасажири п\n            JOIN бронювання_пасажири бп ON п.id = бп.пасажир_id\n            JOIN бронювання б ON бп.бронювання_id = б.id\n            JOIN рейси р ON б.рейс_id = р.id\n            WHERE р.дата_час_відправлення >= CURRENT_DATE - INTERVAL '1 year'\n              AND р.фактичний_час_відправлення IS NOT NULL\n              AND р.фактичний_час_прибуття IS NOT NULL\n              AND б.статус_id IN (SELECT id FROM статуси_бронювань WHERE назва = 'Виконано')\n        )\n        SELECT \n            прізвище,\n            імя,\n            COUNT(DISTINCT рейс_id) AS кількість_рейсів,\n            ROUND(SUM(тривалість_годин)::numeric, 2) AS загальний_наліт_годин,\n            ROUND(AVG(тривалість_годин)::numeric, 2) AS середня_тривалість_рейсу\n        FROM рейси_пасажирів\n        GROUP BY пасажир_id, прізвище, імя\n        HAVING COUNT(DISTINCT рейс_id) >= 5\n        ORDER BY кількість_рейсів DESC, загальний_наліт_годин DESC\n        LIMIT 20;\n        ",
        "difficulty": "complex"
    },
    {
        "question_id": "авіакомпанія_013",
        "db_id": "авіакомпанія",
        "question": "Проаналізуйте завантаженість різних типів літаків та їхню прибутковість за останні 6 місяців.",
        "gold_sql": "\n        WITH рейси_статистика AS (\n            SELECT \n                р.id AS рейс_id,\n                л.id AS літак_id,\n                тл.id AS тип_літака_id,\n                тл.назва AS тип_літака,\n                (р.кількість_місць_економ - р.доступно_місць_економ) * р.вартість_економ +\n                (р.кількість_місць_бізнес - р.доступно_місць_бізнес) * р.вартість_бізнес +\n                (р.кількість_місць_перший_клас - р.доступно_місць_перший_клас) * р.вартість_перший_клас \n                    AS дохід_рейсу,\n                (р.кількість_місць_економ + р.кількість_місць_бізнес + р.кількість_місць_перший_клас - \n                 р.доступно_місць_економ - р.доступно_місць_бізнес - р.доступно_місць_перший_клас) \n                    AS кількість_пасажирів,\n                (р.кількість_місць_економ + р.кількість_місць_бізнес + р.кількість_місць_перший_клас) \n                    AS загальна_кількість_місць,\n                EXTRACT(EPOCH FROM (р.фактичний_час_прибуття - р.фактичний_час_відправлення))/3600 \n                    AS тривалість_годин,\n                м.відстань\n            FROM рейси р\n            JOIN літаки л ON р.літак_id = л.id\n            JOIN типи_літаків тл ON л.тип_літака_id = тл.id\n            JOIN маршрути м ON р.маршрут_id = м.id\n            WHERE р.дата_час_відправлення >= CURRENT_DATE - INTERVAL '6 month'\n              AND р.фактичний_час_відправлення IS NOT NULL\n              AND р.фактичний_час_прибуття IS NOT NULL\n              AND р.статус_id IN (SELECT id FROM статуси_рейсів WHERE назва = 'Виконано')\n        )\n        SELECT \n            тип_літака,\n            COUNT(DISTINCT рейс_id) AS кількість_рейсів,\n            ROUND(AVG(кількість_пасажирів * 100.0 / загальна_кількість_місць), 2) AS середня_заповненість_відсоток,\n            ROUND(AVG(дохід_рейсу), 2) AS середній_дохід_на_рейс,\n            ROUND(SUM(дохід_рейсу), 2) AS загальний_дохід,\n            ROUND(SUM(дохід_рейсу) / SUM(кількість_пасажирів), 2) AS середній_дохід_на_пасажира,\n            ROUND(SUM(дохід_рейсу) / SUM(тривалість_годин), 2) AS середній_дохід_на_годину_польоту,\n            ROUND(SUM(дохід_рейсу) / SUM(відстань), 2) AS середній_дохід_на_кілометр\n        FROM рейси_статистика\n        GROUP BY тип_літака_id, тип_літака\n        ORDER BY загальний_дохід DESC;\n        ",
        "difficulty": "complex"
    },
    {
        "question_id": "авіакомпанія_014",
        "db_id": "авіакомпанія",
        "question": "Знайдіть 10 найбільш завантажених аеропортів за кількістю рейсів та пасажирів.",
        "gold_sql": "\n        WITH статистика_аеропортів AS (\n            -- Вильоти\n            SELECT \n                а.id AS аеропорт_id,\n                а.код_іата,\n                а.назва,\n                а.місто,\n                а.країна,\n                р.id AS рейс_id,\n                'виліт' AS тип_операції,\n                (р.кількість_місць_економ - р.доступно_місць_економ +\n                 р.кількість_місць_бізнес - р.доступно_місць_бізнес +\n                 р.кількість_місць_перший_клас - р.доступно_місць_перший_клас) AS кількість_пасажирів\n            FROM аеропорти а\n            JOIN маршрути м ON а.id = м.аеропорт_відправлення_id\n            JOIN рейси р ON м.id = р.маршрут_id\n            WHERE р.дата_час_відправлення >= CURRENT_DATE - INTERVAL '1 year'\n              AND р.статус_id IN (SELECT id FROM статуси_рейсів WHERE назва IN ('Виконано', 'В польоті'))\n            \n            UNION ALL\n            \n            -- Прильоти\n            SELECT \n                а.id AS аеропорт_id,\n                а.код_іата,\n                а.назва,\n                а.місто,\n                а.країна,\n                р.id AS рейс_id,\n                'приліт' AS тип_операції,\n                (р.кількість_місць_економ - р.доступно_місць_економ +\n                 р.кількість_місць_бізнес - р.доступно_місць_бізнес +\n                 р.кількість_місць_перший_клас - р.доступно_місць_перший_клас) AS кількість_пасажирів\n            FROM аеропорти а\n            JOIN маршрути м ON а.id = м.аеропорт_призначення_id\n            JOIN рейси р ON м.id = р.маршрут_id\n            WHERE р.дата_час_відправлення >= CURRENT_DATE - INTERVAL '1 year'\n              AND р.статус_id IN (SELECT id FROM статуси_рейсів WHERE назва IN ('Виконано', 'В польоті'))\n        )\n        SELECT \n            код_іата,\n            назва,\n            місто,\n            країна,\n            COUNT(DISTINCT рейс_id) AS кількість_рейсів,\n            SUM(CASE WHEN тип_операції = 'виліт' THEN 1 ELSE 0 END) AS кількість_вильотів,\n            SUM(CASE WHEN тип_операції = 'приліт' THEN 1 ELSE 0 END) AS кількість_прильотів,\n            SUM(кількість_пасажирів) AS загальна_кількість_пасажирів,\n            SUM(CASE WHEN тип_операції = 'виліт' THEN кількість_пасажирів ELSE 0 END) AS пасажирів_відправлено,\n            SUM(CASE WHEN тип_операції = 'приліт' THEN кількість_пасажирів ELSE 0 END) AS пасажирів_прибуло\n        FROM статистика_аеропортів\n        GROUP BY аеропорт_id, код_іата, назва, місто, країна\n        ORDER BY кількість_рейсів DESC, загальна_кількість_пасажирів DESC\n        LIMIT 10;\n        ",
        "difficulty": "complex"
    },
    {
        "question_id": "авіакомпанія_015",
        "db_id": "авіакомпанія",
        "question": "Для кожного місяця останнього року знайдіть середні показники пунктуальності рейсів.",
        "gold_sql": "\n        WITH пунктуальність_рейсів AS (\n            SELECT \n                EXTRACT(YEAR FROM р.дата_час_відправлення) AS рік,\n                EXTRACT(MONTH FROM р.дата_час_відправлення) AS місяць,\n                р.id AS рейс_id,\n                CASE \n                    WHEN р.фактичний_час_відправлення IS NULL OR \n                         р.дата_час_відправлення IS NULL THEN NULL\n                    ELSE EXTRACT(EPOCH FROM (р.фактичний_час_відправлення - р.дата_час_відправлення))/60 \n                END AS затримка_вильоту_хвилин,\n                CASE \n                    WHEN р.фактичний_час_прибуття IS NULL OR \n                         р.дата_час_прибуття IS NULL THEN NULL\n                    ELSE EXTRACT(EPOCH FROM (р.фактичний_час_прибуття - р.дата_час_прибуття))/60 \n                END AS затримка_прибуття_хвилин,\n                CASE \n                    WHEN р.фактичний_час_відправлення IS NULL OR \n                         р.дата_час_відправлення IS NULL OR\n                         EXTRACT(EPOCH FROM (р.фактичний_час_відправлення - р.дата_час_відправлення))/60 <= 15 \n                    THEN 1 ELSE 0 \n                END AS вчасний_виліт,\n                CASE \n                    WHEN р.фактичний_час_прибуття IS NULL OR \n                         р.дата_час_прибуття IS NULL OR\n                         EXTRACT(EPOCH FROM (р.фактичний_час_прибуття - р.дата_час_прибуття))/60 <= 15 \n                    THEN 1 ELSE 0 \n                END AS вчасне_прибуття\n            FROM рейси р\n            WHERE р.дата_час_відправлення >= CURRENT_DATE - INTERVAL '1 year'\n              AND р.статус_id IN (SELECT id FROM статуси_рейсів WHERE назва = 'Виконано')\n        )\n        SELECT \n            рік,\n            місяць,\n            COUNT(рейс_id) AS кількість_рейсів,\n            ROUND(AVG(CASE WHEN затримка_вильоту_хвилин > 0 THEN затримка_вильоту_хвилин ELSE 0 END), 2) AS середня_затримка_вильоту_хвилин,\n            ROUND(AVG(CASE WHEN затримка_прибуття_хвилин > 0 THEN затримка_прибуття_хвилин ELSE 0 END), 2) AS середня_затримка_прибуття_хвилин,\n            ROUND(SUM(вчасний_виліт) * 100.0 / COUNT(рейс_id), 2) AS відсоток_вчасних_вильотів,\n            ROUND(SUM(вчасне_прибуття) * 100.0 / COUNT(рейс_id), 2) AS відсоток_вчасних_прибуттів\n        FROM пунктуальність_рейсів\n        GROUP BY рік, місяць\n        ORDER BY рік, місяць;\n        ",
        "difficulty": "complex"
    }
]