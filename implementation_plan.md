# Український BIRD Benchmark: План імплементації

## Огляд проекту

Метою цього проекту є створення повноцінного українського аналогу набору даних BIRD (Benchmarking Intermediate Reasoning for text-to-SQL), спрямованого на оцінку здатності моделей штучного інтелекту розуміти запити українською мовою та генерувати відповідні SQL-запити. 

Набір даних BIRD-UKR покликаний стати першим великомасштабним українським бенчмарком для задач Text-to-SQL, що значно розширить можливості для розвитку AI-рішень для української мови.

## Поточний стан

На даний момент проект має наступні досягнення:
- Створено 8 баз даних різних доменів (100% готово)
- Для кожної бази розроблено схеми, приклади запитів та тестові дані
- Запити розділені на три рівні складності (простий, середній, складний)
- Документацію для кожної бази даних створено

### Наявні бази даних
1. **Лікарня** - медичний заклад
2. **Бібліотека** - бібліотечна система
3. **Університет** - навчальний заклад
4. **Інтернет-магазин** - система онлайн торгівлі
5. **Ресторан** - система ресторанного бізнесу
6. **Туристичне агентство** - туристичні послуги
7. **Авіакомпанія** - авіаперевезення
8. **Спортивний клуб** - спортивні послуги

## Структура файлів проекту

Цей документ детально описує структуру файлів проекту BIRD-UKR, включаючи існуючі файли та ті, які потрібно створити для повноцінної реалізації бенчмарку.

```
slowdown-macsql/                      # Корінь репозиторію
├── MAC-SQL/                          # Оригінальна директорія проекту MAC-SQL
│   ├── data/                         # Директорія даних
│   │   ├── bird-ukr/                 # Головна директорія українського набору даних
│   │   │   ├── database/             # Директорія з базами даних
│   │   │   │   ├── спортивний_клуб/  # Бази даних з різних доменів
│   │   │   │   ├── лікарня/
│   │   │   │   ├── університет/
│   │   │   │   ├── ресторан/
│   │   │   │   ├── банк/
│   │   │   │   ├── аеропорт/
│   │   │   │   ├── онлайн_магазин/
│   │   │   │   └── готель/
│   │   │   ├── expansion_plan.md     # План розширення набору даних
│   │   │   └── README.md             # Загальна документація
├── bird-ukr/                         # Директорія бенчмарку (нова, потрібно створити)
│   ├── questions.json                # Файл з питаннями та SQL-запитами
│   ├── database/                     # Копія баз даних з MAC-SQL/data/bird-ukr/database
│   │   ├── спортивний_клуб/
│   │   ├── лікарня/
│   │   ├── ...
│   ├── tables.json                   # Описи схем баз даних
│   ├── column_meaning.json           # Опис значення кожного стовпця
│   ├── README.md                     # Детальна документація бенчмарку
│   └── GUIDELINES.md                 # Методичні матеріали
├── scripts/                          # Скрипти для роботи з даними
│   ├── generate_json.py              # Генерація JSON-файлів з питаннями та запитами
│   └── generate_metadata.py          # Створення метаданих (tables.json, column_meaning.json)
├── evaluation/                       # Скрипти для оцінки
│   ├── evaluate_ex.py                # Оцінка точності виконання запитів
│   ├── evaluate_em.py                # Оцінка Exact Match Accuracy
│   ├── benchmark.py                  # Тестування моделей
│   └── results/                      # Результати оцінки
│       ├── baseline_results.json     # Базові результати
│       └── model_comparison.json     # Порівняння моделей
└── tests/                            # Тести
    ├── validate_queries.py           # Валідація запитів
    └── test_evaluation.py            # Тестування скриптів оцінки
```

### Структура бази даних

Кожна база даних в директорії `database/` має наступну структуру:

```
database/спортивний_клуб/
├── schema.sql                # Визначення схеми бази даних
├── import.sql                # Скрипт для імпорту даних
├── sample_queries.sql        # Приклади запитів
├── data_tables.sql           # SQL з даними для таблиць
└── README.md                 # Опис бази даних
```

### Формат JSON-файлів

Основний файл для бенчмарку - JSON-файл, який містить питання та відповідні SQL-запити:

```json
[
  {
    "question_id": "спортивний_клуб_001",
    "db_id": "спортивний_клуб",
    "db_path": "database/спортивний_клуб",
    "question": "Скільки тренерів працює в спортивному клубі?",
    "gold_sql": "SELECT COUNT(*) FROM тренери",
    "difficulty": "simple",
    "evidence": null,
    "execution_details": {
      "execution_time": 0.023,
      "result_size": 1
    }
  },
  {
    "question_id": "лікарня_023",
    "db_id": "лікарня",
    "db_path": "database/лікарня",
    "question": "Які лікарі працюють у відділеннях з більш ніж 10 пацієнтами?",
    "gold_sql": "SELECT л.прізвище, л.ім'я FROM лікарі л JOIN відділення в ON л.відділення_id = в.id WHERE (SELECT COUNT(*) FROM пацієнти п WHERE п.відділення_id = в.id) > 10",
    "difficulty": "complex",
    "evidence": null,
    "execution_details": {
      "execution_time": 0.045,
      "result_size": 5
    }
  }
]
```

### Метадані

Файли метаданих необхідні для роботи з бенчмарком:

1. **tables.json** - Опис схем баз даних:

```json
{
  "спортивний_клуб": {
    "table_names": ["тренери", "члени", "групові_заняття", "відвідування"],
    "column_names": [
      ["тренери", "id"], 
      ["тренери", "прізвище"], 
      ["тренери", "ім'я"],
      // ... інші колонки
    ],
    "column_types": [
      "number", "text", "text", // ... типи для колонок
    ],
    "foreign_keys": [
      [8, 1], // FK члени.тренер_id -> тренери.id
      // ... інші зв'язки
    ],
    "primary_keys": [1, 5, 9, 13]
  },
  // ... інші бази даних
}
```

2. **column_meaning.json** - Опис значень колонок:

```json
{
  "спортивний_клуб": {
    "тренери.id": "Унікальний ідентифікатор тренера",
    "тренери.прізвище": "Прізвище тренера",
    // ... опис інших колонок
  },
  // ... інші бази даних
}
```

## Необхідні кроки для створення бенчмарку

### 1. Створення питань природною мовою та пар питання-SQL

Необхідно розробити набір питань українською мовою з відповідними SQL-запитами:
- **Обсяг**: 50-100 питань для кожної бази даних (400-800 загалом)
- **Розподіл**: рівномірний розподіл за рівнями складності
- **Особливості української мови**: врахування відмінків, родів, множини

### 2. Структуризація даних у форматі BIRD

Дані необхідно організувати у стандартний JSON-формат відповідно до структури, описаної вище.

### 3. Імплементація механізмів оцінки

Впровадження стандартних метрик BIRD:
- **Execution Accuracy (EX)** - точність виконання запиту
- **Exact Match Accuracy (EM)** - точність повного співпадіння

### 4. Розробка документації та методичних матеріалів

Створення:
- Детальної документації з використання бенчмарку
- Опису кожної бази даних та її структури
- Методичних рекомендацій для моделювання

### 5. Тестування та валідація

- Перевірка коректності всіх SQL-запитів
- Тестування на PostgreSQL
- Оцінка еталонних моделей (baseline)

## Часовий графік

| Етап | Тривалість | Дедлайн |
|------|------------|---------|
| Створення питань і SQL-пар | 4 тижні | [Дата] |
| Структуризація у форматі BIRD | 2 тижні | [Дата] |
| Імплементація механізмів оцінки | 3 тижні | [Дата] |
| Розробка документації | 2 тижні | [Дата] |
| Тестування та валідація | 2 тижні | [Дата] |

## Вимоги до питань природною мовою

1. **Розподіл за рівнями складності**:
   - **Прості** (30%): прямі запити до однієї таблиці, базові фільтри
   - **Середні** (40%): кілька таблиць, підзапити, агрегації
   - **Складні** (30%): складні JOIN, підзапити в підзапитах, віконні функції

2. **Типи питань**:
   - Питання з агрегацією (COUNT, SUM, AVG, MIN, MAX)
   - Питання з сортуванням (ORDER BY)
   - Питання з обмеженням кількості результатів (LIMIT)
   - Питання з фільтрацією (WHERE)
   - Питання з групуванням (GROUP BY)
   - Питання з об'єднанням даних (JOIN)
   - Питання з підзапитами (Subqueries)

3. **Лексичне різноманіття**:
   - Синоніми та різні формулювання запитів
   - Використання специфічної термінології за доменами

## Особливості локалізації

1. **Українські особливості**:
   - Врахування відмінків в іменах таблиць та стовпців
   - Правильне відображення діакритичних знаків
   - Узгодження граматичних форм у питаннях

2. **Технічні аспекти**:
   - Кодування UTF-8 для підтримки української мови
   - Валідація запитів з українськими символами
   - Обробка специфічних для української мови символів у SQL

## Поточний стан реалізації

✅ - Існує і готово
🔄 - В розробці
❌ - Потрібно створити

| Директорія/Файл | Стан | Примітки |
|-----------------|------|----------|
| `MAC-SQL/data/bird-ukr/database/` | ✅ | 7 готових баз даних + 1 в розробці |
| `MAC-SQL/data/bird-ukr/expansion_plan.md` | ✅ | План розширення існує |
| `bird-ukr/` | ❌ | Потрібно створити директорію бенчмарку |
| `bird-ukr/questions.json` | ❌ | Потрібно створити файл з питаннями та SQL-запитами |
| `scripts/` | ❌ | Потрібно створити скрипти |
| `evaluation/` | ❌ | Потрібно створити скрипти оцінки |
| `tasks_and_guidelines.md` | ✅ | Детальний опис завдань |
| `example_question_templates.md` | ✅ | Шаблони питань |
| `implementation_plan.md` | ✅ | План імплементації |

## Прогрес імплементації

### Загальний прогрес проекту
![Загальний прогрес](https://progress-bar.dev/35/?width=300)

### Прогрес по основних компонентах

| Компонент | Прогрес | Візуалізація |
|-----------|---------|--------------|
| Бази даних та схеми | 85% | ![Бази даних](https://progress-bar.dev/85/?width=200) |
| Питання та запити | 10% | ![Питання та запити](https://progress-bar.dev/10/?width=200) |
| Структуризація даних | 5% | ![Структуризація](https://progress-bar.dev/5/?width=200) |
| Механізми оцінки | 0% | ![Механізми оцінки](https://progress-bar.dev/0/?width=200) |
| Документація | 40% | ![Документація](https://progress-bar.dev/40/?width=200) |
| Тестування | 0% | ![Тестування](https://progress-bar.dev/0/?width=200) |

### Покрокова діаграма прогресу

```
Бази даних        [==========================>          ] 85%
Питання та запити [===>                                 ] 10%
Підготовка JSON   [=>                                   ] 5%
Метрики оцінки    [                                     ] 0%
Документація      [==============>                      ] 40%
Тестування        [                                     ] 0%
----------------------------------------------------------
ЗАГАЛОМ           [=========>                           ] 35%
``` 