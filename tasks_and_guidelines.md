# Український BIRD Benchmark: Покрокова інструкція

## Технічні завдання для реалізації бенчмарку

Цей документ містить детальний опис технічних завдань для перетворення існуючих українських баз даних у повноцінний бенчмарк BIRD-UKR.

## Огляд наявних файлів

Наразі проект має наступну структуру:
```
slowdown-macsql/
├── MAC-SQL/
│   ├── data/
│   │   ├── bird-ukr/                 # Головна директорія українського набору даних
│   │   │   ├── database/             # Директорія з базами даних
│   │   │   │   ├── лікарня/          # Директорія бази даних "Лікарня"
│   │   │   │   │   ├── schema.sql    # Схема бази даних
│   │   │   │   │   ├── sample_queries.sql  # Приклади запитів
│   │   │   │   │   ├── import.sql    # Скрипт імпорту даних
│   │   │   │   │   ├── README.md     # Документація
│   │   │   │   │   └── data_*.sql    # Файли з даними
│   │   │   │   ├── ...               # Інші бази даних з аналогічною структурою
```

## 1. Створення питань та SQL-пар

### Завдання 1.1: Розробка шаблону для питань
- Створити шаблон для формування питань різних типів і рівнів складності
- Вимоги: структурованість, однаковий формат, зрозумілість
- Файл зі зразками шаблонів: `example_question_templates.md`

### Завдання 1.2: Генерація питань для бази "Спортивний клуб"
- Використовуючи схему бази даних `MAC-SQL/data/bird-ukr/database/спортивний_клуб/schema.sql`
- Створити мінімум 10 питань простого рівня
- Створити мінімум 15 питань середнього рівня
- Створити мінімум 10 питань складного рівня
- Написати відповідні SQL-запити для кожного питання
- Зберегти у новий файл `bird-ukr/questions/спортивний_клуб_questions.json`

### Завдання 1.3: Повторити для інших баз даних
- Послідовно створити питання і запити для кожної з 7 баз даних у директорії `MAC-SQL/data/bird-ukr/database/`
- Перевірити виконання запитів на тестових даних
- Забезпечити рівномірний розподіл питань за рівнями складності
- Зберегти у відповідні файли в директорії `bird-ukr/questions/`

## 2. Структуризація даних

### Завдання 2.1: Створення структури директорій
Створити наступну структуру директорій:
```
bird-ukr/                     # Основний каталог бенчмарку
├── questions/                # Директорія для питань
├── database/                 # Директорія для баз даних
│   ├── спортивний_клуб/      # Директорії з базами даних (копії з MAC-SQL/data/bird-ukr/database)
│   ├── лікарня/
│   ├── ...
```

### Завдання 2.2: Розробка JSON-форматів
- Створити скрипт `scripts/generate_json.py` для генерації єдиного JSON-файлу з питаннями та запитами
- Формат: `questions.json`
- Структура запису:
```json
{
  "question": "Запитання українською мовою",
  "question_id": "unique_id",
  "db_id": "спортивний_клуб",
  "db_path": "database/спортивний_клуб",
  "gold_sql": "SQL-запит",
  "evidence": "Додаткова інформація (опціонально)",
  "difficulty": "simple|medium|complex"
}
```

### Завдання 2.3: Створення метаданих
- Створити скрипт `scripts/generate_metadata.py` для створення метаданих
- Створити `tables.json` з описом схем баз даних (аналізуючи файли schema.sql)
- Створити `column_meaning.json` з описом значення кожного стовпця

## 3. Розробка механізмів оцінки

### Завдання 3.1: Імплементація Execution Accuracy (EX)
- Створити директорію `evaluation/` для розміщення скриптів оцінки
- Створити скрипт `evaluation/evaluate_ex.py` для оцінки точності виконання
- Функціонал: порівняння результатів виконання згенерованого і еталонного запитів
- Обробка крайових випадків: NULL, різний порядок рядків, точність чисел

### Завдання 3.2: Імплементація Exact Match Accuracy (EM)
- Створити скрипт `evaluation/evaluate_em.py` для оцінки точного співпадіння SQL-запитів
- Порівняння текстового представлення запитів з урахуванням можливих синтаксичних варіацій
- Нормалізація запитів перед порівнянням
- Оцінка бінарна: 0 або 1 (повне співпадіння або ні)

## 4. Розробка документації

### Завдання 4.1: Створення технічної документації
- Створити файл `bird-ukr/README.md` з детальною документацією
- Написати документацію по структурі проекту
- Описати формат даних та API для оцінки
- Підготувати інструкцію з використання бенчмарку

### Завдання 4.2: Створення методичних матеріалів
- Створити файл `bird-ukr/GUIDELINES.md` з методичними матеріалами
- Підготувати опис особливостей української мови для Text-to-SQL
- Створити приклади використання бенчмарку
- Розробити рекомендації для оптимізації моделей

## 5. Тестування та валідація

### Завдання 5.1: Базові тести
- Створити директорію `tests/` для тестів
- Створити скрипт `tests/validate_queries.py` для перевірки запитів
- Перевірити виконання всіх SQL-запитів в наборі даних
- Переконатися у відсутності синтаксичних помилок
- Валідувати відповідність питань і запитів

### Завдання 5.2: Тестування на моделях
- Створити скрипт `evaluation/benchmark.py` для тестування моделей
- Провести оцінку з використанням базових моделей (GPT-3.5, Llama, тощо)
- Зібрати статистики продуктивності
- Визначити baseline для майбутніх порівнянь
- Зберегти результати в `evaluation/results/`

## Початковий план роботи (перші 2 тижні)

| День | Завдання | Відповідальний | Вихідний файл |
|------|----------|----------------|---------------|
| 1-2  | Розробка шаблону для питань | [ПІБ] | `example_question_templates.md` |
| 3-5  | Генерація питань для "Спортивний клуб" | [ПІБ] | `bird-ukr/questions/спортивний_клуб_questions.json` |
| 6-7  | Створення структури директорій та JSON-форматів | [ПІБ] | `scripts/generate_json.py` |
| 8-10 | Генерація питань для "Лікарня" | [ПІБ] | `bird-ukr/questions/лікарня_questions.json` |
| 11-12| Початок розробки механізмів оцінки | [ПІБ] | `evaluation/evaluate_ex.py` |
| 13-14| Тестування на перших двох базах даних | [ПІБ] | `tests/validate_queries.py` |

## Критерії якості

1. **Питання і запити**:
   - Граматична правильність українських питань
   - Синтаксична правильність SQL-запитів
   - Відповідність питань і запитів
   - Рівномірний розподіл за складністю

2. **Технічна реалізація**:
   - Відповідність JSON-формату стандарту BIRD
   - Коректність механізмів оцінки
   - Швидкодія оцінки результатів

3. **Документація**:
   - Повнота технічної документації
   - Зрозумілість інструкцій
   - Наявність прикладів використання

## Залежності проекту

Для роботи з проектом необхідно встановити наступні залежності:
```
pip install -r requirements.txt
```

Файл `requirements.txt` повинен містити:
```
psycopg2-binary  # Для роботи з PostgreSQL
pandas           # Для аналізу даних
tqdm             # Для індикації прогресу
```

## Прогрес виконання завдань

### Загальний прогрес завдань
![Загальний прогрес](https://progress-bar.dev/20/?width=300)

### Прогрес по розділах

| Розділ | Кількість завдань | Виконано | Прогрес |
|--------|-------------------|----------|---------|
| 1. Створення питань та SQL-пар | 3 | 1 | ![Прогрес](https://progress-bar.dev/33/?width=200) |
| 2. Структуризація даних | 3 | 0 | ![Прогрес](https://progress-bar.dev/0/?width=200) |
| 3. Розробка механізмів оцінки | 2 | 0 | ![Прогрес](https://progress-bar.dev/0/?width=200) |
| 4. Розробка документації | 2 | 0.5 | ![Прогрес](https://progress-bar.dev/25/?width=200) |
| 5. Тестування та валідація | 2 | 0 | ![Прогрес](https://progress-bar.dev/0/?width=200) |

### Детальний прогрес завдань

| Завдання | Статус | Прогрес |
|----------|--------|---------|
| 1.1: Розробка шаблону для питань | ✅ Завершено | 100% |
| 1.2: Генерація питань для "Спортивний клуб" | 🔄 В процесі | 20% |
| 1.3: Повторити для інших баз даних | ❌ Не розпочато | 0% |
| 2.1: Створення структури директорій | ❌ Не розпочато | 0% |
| 2.2: Розробка JSON-форматів | ❌ Не розпочато | 0% |
| 2.3: Створення метаданих | ❌ Не розпочато | 0% |
| 3.1: Імплементація Execution Accuracy | ❌ Не розпочато | 0% |
| 3.2: Імплементація Exact Match Accuracy | ❌ Не розпочато | 0% |
| 4.1: Створення технічної документації | 🔄 В процесі | 40% |
| 4.2: Створення методичних матеріалів | 🔄 В процесі | 10% |
| 5.1: Базові тести | ❌ Не розпочато | 0% |
| 5.2: Тестування на моделях | ❌ Не розпочато | 0% |

### Графік виконання
```
[Week 1] [================>  ] 80% Шаблони питань і документація
[Week 2] [=====>             ] 25% Питання для бази "Спортивний клуб"
[Week 3] [                   ] 0%  Питання для інших баз даних
[Week 4] [                   ] 0%  Структуризація даних
[Week 5] [                   ] 0%  Механізми оцінки та тестування
``` 